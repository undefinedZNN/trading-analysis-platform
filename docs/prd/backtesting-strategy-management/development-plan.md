# 回测策略管理与回测平台开发计划

## 里程碑总览
1. **M1：回测策略管理基础能力**（目标：沉淀策略脚本与参数模板，为回测引擎准备配置数据）
2. **M2：回测引擎核心闭环**（目标：打通任务提交到 Worker 执行的最小链路）
3. **M3：回测执行增强**（目标：完善调度、日志、因子事件流，产出完整执行数据）
4. **M4：回测结果分析体验**（目标：指标展示、因子筛选、对比与导出）

> 监控、权限、配额等平台化能力暂归入后续优化阶段，不纳入当前里程碑。

---

## M1：回测策略管理基础能力
- **后端**
  - 建模并实现策略脚本、版本、参数模板、变量/因子 JSON Schema 的持久化与审计。
  - 提供策略上传、版本管理、参数模板 CRUD 的 API；接入静态校验（TS 类型检查、依赖白名单）。
  - 与策略参数实例化流程打通，输出供后续回测任务引用的配置快照。
- **前端**
  - 策略列表/详情页，支持搜索、标签筛选、版本切换。
  - 策略上传/编辑向导，接入 JSON Schema 表单组件，支持变量与因子配置。
  - 参数模板管理界面，支持模板实例复制、差异对比。
- **QA**
  - 建立策略管理模块用例：版本上传、参数模板 CRUD、Schema 校验失败场景。
  - 验证前端表单渲染与后端 Schema 一致性，覆盖主流浏览器。
  - 准备冒烟测试脚本，为后续阶段复用。

## M2：回测引擎核心闭环
- **后端**
  - 实现 Orchestrator、Execution Broker、Bun Worker 基础框架；支撑最小回测任务执行。
  - 开发数据访问 SDK（读取交易数据模块、构建临时视图）和策略运行时上下文。
  - 接入任务状态机（Submitted/Running/Finished/Failed）与基本日志回传。
- **前端**
  - 回测任务创建向导，串联策略选择、参数模板、时间区间、数据集绑定。
  - 任务列表与基础状态展示，支持手动触发执行与终止。
  - 提供任务详情页初版（参数快照、执行状态、实时日志占位）。
- **QA**
  - 设计任务提交流程用例，覆盖策略参数/数据范围校验。
  - 通过模拟数据验证 Worker 调用链路可执行、失败场景有明确提示。
  - 搭建自动化脚本（API 层）验证核心任务状态流转。

## M3：回测执行增强
- **后端**
  - 完善任务调度（优先级、重试策略、手动终止）、Worker 并发控制。
  - 实现执行过程反馈：进度事件、关键日志片段、因子/指标事件流，落地结果存储。
  - 构建输出产物管理（订单流水、指标 JSON、因子数据、快照文件）与下载权限控制。
- **前端**
  - 任务详情页增强：进度条、日志流、指标预览、产物列表。
  - 支持任务复制配置再执行、失败重试入口。
  - 增加因子事件流与指标样本展示视图。
- **QA**
  - 针对调度/重试/终止等状态迁移编写场景测试。
  - 验证日志与进度推送的实时性、稳定性；检查产物下载权限。
  - 回归 M1/M2 功能，确保新增特性不破坏既有流程。

## M4：回测结果分析体验
- **后端**
  - 因子与指标聚合 API：支持多任务对比、维度筛选、分页查询。
  - 对接导出服务，生成 PDF/Excel 报表以及原始数据打包下载。
  - 优化结果存储索引（DuckDB/Parquet 分区、PostgreSQL 元数据）以提升查询性能。
- **前端**
  - 回测结果分析控制台：指标仪表盘、净值曲线、仓位与风控事件视图。
  - 因子筛选器基于 `x-filter` schema 自动生成，支持组合条件与收藏。
  - 多任务/多版本对比页面，展示指标、净值曲线、收益分布差异。
- **QA**
  - 场景测试：筛选条件组合、任务对比、导出校验。
  - 性能验证：大数据量因子检索、图表渲染流畅性。
  - 交互验收：不同屏幕尺寸下的展示与易用性回归。
